//requiring express 
const express = require("express")
//setting a router , app. is replaced by router. here on in this file
const router = express.Router()
// importing the schema of mongoose
const IntervalUsage = require('../model/interval')
 // using json structire in express 
 router.use(express.json());


// Making a endpoint at /output/peruserdata that sends the data 
// will make it so if a time period is not given it will be all data
// and if user is not specified , it will send all user's data
// Sample input for this Endpoint
// {                     
//      "fromdate" : "Number",
//      "todate" : "Number",
// }
router.post('/peruserdata', (req, res) => {
    res.json({"request" : "Acknowledged"})
    userrequest = req.body
    if (!userrequest.fromdate){
        userrequest.fromdate = 0 
    }
    if (!userrequest.todate){
        userrequest.todate = 9999999999
    }
    console.log(userrequest)
    
    
    IntervalUsage.find({ "date" :{
        "$gt" : userrequest.fromdate,
        "$lt" : userrequest.todate
    }},{ _id : 0 , __v : 0} , (err, data) => {
        if(err){
            console.log(err)
        } 
        else {
            console.log(data)
        Object.entries(data).forEach(entry => {
            [key , value] = entry
            console.log(value)
        })
        }

    })




})



module.exports = router;